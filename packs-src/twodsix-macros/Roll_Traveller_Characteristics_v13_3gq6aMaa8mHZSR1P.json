{
  "name": "Roll Traveller Characteristics v13",
  "type": "script",
  "scope": "global",
  "author": "g35c71Hsyv7w1Lw4",
  "img": "systems/twodsix/assets/icons/jack-of-all-trades.svg",
  "command": "//updated for FVTT v13\n\nasync function characteristicsMacro() {\n  // Create the dialog window\n  let dialogTemplate = `\n    <div style=\"display: flex; flex-direction: column;\">\n      <h2>Traveller Characteristics Roller</h2>\n      <div>\n        <p>Select rolling options:</p>\n        <label><input type=\"radio\" name=\"option\" value=\"roll6\" checked>Roll 2d6, 6 times</label><br>\n        <label><input type=\"radio\" name=\"option\" value=\"roll7\">Roll 2d6, 7 times, dropping the lowest result</label><br><br>\n      </div>\n      <div>\n        <h3>Alternate Characteristics </h3>\n        <div style=\"display: flex;\">\n          <div style=\"flex: 1;\">\n            <label>Alt. Characteristic 1 Name:</label>\n            <input type=\"text\" name=\"altSkill1Name\" value=\"Psi\"><br>\n            <label>Alt. Characteristic 2 Name:</label>\n            <input type=\"text\" name=\"altSkill2Name\" value=\"Luck\"><br>\n            <label>Alt. Characteristic 3 Name:</label>\n            <input type=\"text\" name=\"altSkill3Name\" value=\"Sanity\"><br>\n          </div>\n          <div style=\"flex: 1;\">\n            <label>Alt. Skill 1 Dice (e.g., 2d6):</label>\n            <input type=\"text\" name=\"altSkill1Dice\" value=\"2d6\"><br>\n            <label>Alt. Skill 2 Dice (e.g., 1d6+1):</label>\n            <input type=\"text\" name=\"altSkill2Dice\" value=\"1d6+1\"><br>\n            <label>Alt. Skill 3 Dice (e.g., 1d6+1):</label>\n            <input type=\"text\" name=\"altSkill3Dice\" value=\"1d6+1\"><br>\n          </div>\n        </div>\n        <label>Disable Alt. Characteristics:</label>\n        <input type=\"checkbox\" name=\"disableAltSkills\" checked>\n      </div>\n    </div>\n  `;\n\n  let dialogData = {\n    title: \"Traveller RPG Macro\",\n    content: dialogTemplate,\n    buttons: [\n      {\n        action: \"rollNow\",\n        icon: 'fas fa-dice',\n        label: \"Roll Now!\",\n        default: true,\n        callback: async (_event, target) => {\n          // Get selected options and alt skill values\n          const option = target.form.elements.option.value;\n          const altSkill1Name = target.form.elements.altSkill1Name.value;\n          const altSkill1Dice = target.form.elements.altSkill1Dice.value;\n          const altSkill2Name = target.form.elements.altSkill2Name.value;\n          const altSkill2Dice = target.form.elements.altSkill2Dice.value;\n          const altSkill3Name = target.form.elements.altSkill3Name.value;\n          const altSkill3Dice = target.form.elements.altSkill3Dice.value;\n          const disableAltSkills = target.form.elements.disableAltSkills.checked;\n\n          // Roll the dice and display the results\n          let resultMessage = \"<h2>Results:</h2>\";\n\n          if (option === \"roll6\") {\n            resultMessage += \"<strong>Roll 2d6, 6 times:</strong><br>\";\n            resultMessage += \"<table><tr><th>1st Die</th><th>2nd Die</th><th>Total</th></tr>\";\n            for (let i = 1; i <= 6; i++) {\n              const roll1 = await new Roll(\"d6\").roll();\n              const roll2 = await new Roll(\"d6\").roll();\n              const rollTotal = roll1.total + roll2.total;\n              resultMessage += `<tr><td>${roll1.total}</td><td>${roll2.total}</td><td>${rollTotal}</td></tr>`;\n            }\n            resultMessage += \"</table>\";\n          } else if (option === \"roll7\") {\n            resultMessage += \"<strong>Roll 2d6, 7 times, dropping the lowest result:</strong><br>\";\n            resultMessage += \"<table><tr><th>1st Die</th><th>2nd Die</th><th>Total</th></tr>\";\n            let rolls = [];\n            for (let i = 1; i <= 7; i++) {\n              const roll1 = await new Roll(\"d6\").roll();\n              const roll2 = await new Roll(\"d6\").roll();\n              const rollTotal = roll1.total + roll2.total;\n              rolls.push({ rollTotal, roll1, roll2 });\n            }\n            rolls.sort((a, b) => a.rollTotal - b.rollTotal);\n            for (let i = 0; i < rolls.length; i++) {\n              const { rollTotal, roll1, roll2 } = rolls[i];\n              if (i === 0) {\n                resultMessage += `<tr style=\"background-color: black; color: white;\"><td>${roll1.total}</td><td>${roll2.total}</td><td>${rollTotal}</td></tr>`;\n              } else {\n                resultMessage += `<tr><td>${roll1.total}</td><td>${roll2.total}</td><td>${rollTotal}</td></tr>`;\n              }\n            }\n            resultMessage += \"</table>\";\n          }\n\n          if (!disableAltSkills) {\n            // Check if altSkill1Dice and altSkill2Dice are not empty\n            if (altSkill1Dice && altSkill2Dice) {\n              const altRoll1 = await new Roll(altSkill1Dice).roll();\n              const altRoll2 = await new Roll(altSkill2Dice).roll();\n              resultMessage += `<strong>${altSkill1Name} (${altSkill1Dice}):</strong> ${altRoll1.total}<br>`;\n              resultMessage += `<strong>${altSkill2Name} (${altSkill2Dice}):</strong> ${altRoll2.total}<br>`;\n              if (altSkill3Dice) {\n                const altRoll3 = await new Roll(altSkill3Dice).roll();\n                resultMessage += `<strong>${altSkill3Name} (${altSkill3Dice}):</strong> ${altRoll3.total}<br>`;\n              }\n            }\n          }\n\n          // Display the results in a chat message\n          ChatMessage.create({\n            content: resultMessage,\n            speaker: ChatMessage.getSpeaker(),\n          });\n        },\n      },\n      {\n        action: \"cancel\",\n        icon: 'fas fa-times',\n        label: \"Cancel\",\n      },\n    ]\n  };\n\n  // Show the dialog\n  await new foundry.applications.api.DialogV2(dialogData).render(true);\n}\n\n// Call the macro function\ncharacteristicsMacro();",
  "folder": null,
  "ownership": {
    "default": 0,
    "g35c71Hsyv7w1Lw4": 3
  },
  "flags": {
    "core": {}
  },
  "_stats": {
    "compendiumSource": null,
    "duplicateSource": null,
    "coreVersion": "13.350",
    "systemId": "twodsix",
    "systemVersion": "6.8.1",
    "createdTime": 1738176331980,
    "modifiedTime": 1760016422560,
    "lastModifiedBy": "g35c71Hsyv7w1Lw4",
    "exportSource": null
  },
  "_id": "3gq6aMaa8mHZSR1P",
  "sort": 1400000,
  "_key": "!macros!3gq6aMaa8mHZSR1P"
}
