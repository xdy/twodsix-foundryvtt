{
  "name": "Heal for GM or Player v12",
  "type": "script",
  "author": "OIomk1IgyRly5ocC",
  "img": "systems/twodsix/assets/icons/heart-plus.svg",
  "scope": "global",
  "command": "const MULTIPLIER = 1.0;\nconst patients = game.user.targets;\nlet doctor = token.actor ?? game.user.character;\n\n// Heal if doctor and patients are defined\nif (doctor && patients) {\n  for (const patient of patients) {\n\t  await healCharacter(doctor, patient.actor);\n  }\n}\n\nasync function healCharacter (healer, patient) {\n\t// Check that doctor has Medkit or Medical Kit\n\tlet medKit = healer.items.find(item => ['medical kit', 'medkit'].includes(item.name.toLowerCase()));\n\tlet healRoll = {};\n\tlet medSkill = {};\n\tif (medKit) {\n\t\tmedSkill = healer.items.get(medKit.system.skill);\n\t\tif (!medSkill.getFlag(\"twodsix\", \"untrainedSkill\")) {\n\t\t\thealRoll = await medKit.skillRoll(true);\n\t\t} else {\n\t\t\t// Check whether doctor has Medicine skill\n\t\t\tmedSkill = healer.itemTypes.skills.find(item => item.name.toLowerCase() === 'medicine');\n\t\t\tif (medSkill) {\n\t\t\t\tconst tempSettings = await game.twodsix.TwodsixRollSettings.create(true, {}, medSkill, medKit, healer);\n\t\t\t\thealRoll = await medSkill.skillRoll(true, tempSettings);\n\t\t\t}\n\t\t}\n\t}\n\n\tif  (Object.keys(healRoll).length === 0) {\n\t\tconsole.log(\"Can't make roll\", \"Medkit: \", medKit, \"Med Skill: \", medSkill);\n\t\treturn; \n\t}\n\tlet pointsToHeal = healRoll.effect * MULTIPLIER;\n\tawait patient.healActor(pointsToHeal);\n}",
  "flags": {
    "core": {},
    "cf": {
      "id": "temp_4phcz5md1kh"
    }
  },
  "ownership": {
    "default": 0,
    "KrOiJLcZ94d4ZOL3": 3,
    "GOmBKof9PfoHZ54T": 3,
    "OIomk1IgyRly5ocC": 3
  },
  "_stats": {
    "systemId": "twodsix",
    "systemVersion": "6.8.1",
    "coreVersion": "13.350",
    "createdTime": 1659117716881,
    "modifiedTime": 1760016422573,
    "lastModifiedBy": "g35c71Hsyv7w1Lw4",
    "compendiumSource": "Macro.f3bsdD0dXQcWdHaW",
    "duplicateSource": null,
    "exportSource": null
  },
  "folder": null,
  "sort": 3000000,
  "_id": "xpgbOkPeYsAcjDrm",
  "_key": "!macros!xpgbOkPeYsAcjDrm"
}
