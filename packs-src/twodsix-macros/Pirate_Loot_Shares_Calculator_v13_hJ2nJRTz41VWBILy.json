{
  "name": "Pirate Loot Shares Calculator v13",
  "type": "script",
  "scope": "global",
  "author": "g35c71Hsyv7w1Lw4",
  "img": "systems/twodsix/assets/icons/open-treasure-chest.svg",
  "command": "//updated for v13\n(async () => {\n  // Function to save input values and checkbox state to local storage\n  function saveInputsToLocalStorage(inputs) {\n    for (const [key, value] of Object.entries(inputs)) {\n      localStorage.setItem(key, value);\n    }\n    localStorage.setItem(\"travellerCaptain\", inputs[\"travellerCaptain\"]);\n  }\n\n  // Function to retrieve input values and checkbox state from local storage\n  function getInputsFromLocalStorage() {\n    const inputs = {};\n    const keys = [\"netLoot\", \"travellers\", \"captain\", \"ordinary\", \"good\", \"excellent\", \"legendary\", \"other\"];\n    for (const key of keys) {\n      const value = localStorage.getItem(key);\n      inputs[key] = value !== null ? parseInt(value) : 0; // Treat blank values as zero\n    }\n    inputs[\"travellerCaptain\"] = localStorage.getItem(\"travellerCaptain\") === \"true\";\n    return inputs;\n  }\n\n  // Create the first dialog\n  const previousInputs = getInputsFromLocalStorage();\n\n  const firstDialog = new foundry.applications.api.DialogV2({\n    window: {\n      title: \"Calculate Shares\",\n      icon: \"fa-solid fa-skull-crossbones\"\n    },\n    content: `\n      <div>\n        <b>Net Loot:</b>\n        <input type=\"number\" name=\"netLoot\" value=\"${previousInputs[\"netLoot\"]}\" />\n      </div>\n      <div>\n        <b>Travellers (2 Shares Each):</b>\n        <input type=\"number\" name=\"travellers\" value=\"${previousInputs[\"travellers\"]}\" />\n        <span id=\"traveller-cut\"></span>\n      </div>\n      <div>\n        <b>Captain (5 Shares Each):</b>\n        <input type=\"number\" name=\"captain\" value=\"${previousInputs[\"captain\"]}\" />\n        <label for=\"travellerCaptain\">Is a Traveller Captain?</label>\n        <input type=\"checkbox\" name=\"travellerCaptain\" ${previousInputs[\"travellerCaptain\"] ? \"checked\" : \"\"} />\n        <span id=\"captain-cut\"></span>\n      </div>\n      <div>\n        <b>Ordinary Crew (1 Share Each):</b>\n        <input type=\"number\" name=\"ordinary\" value=\"${previousInputs[\"ordinary\"]}\" />\n        <span id=\"ordinary-cut\"></span>\n      </div>\n      <div>\n        <b>Good Crew (2 Shares Each):</b>\n        <input type=\"number\" name=\"good\" value=\"${previousInputs[\"good\"]}\" />\n        <span id=\"good-cut\"></span>\n      </div>\n      <div>\n        <b>Excellent Crew (3 Shares Each):</b>\n        <input type=\"number\" name=\"excellent\" value=\"${previousInputs[\"excellent\"]}\" />\n        <span id=\"excellent-cut\"></span>\n      </div>\n      <div>\n        <b>Legendary Crew (5 Shares Each):</b>\n        <input type=\"number\" name=\"legendary\" value=\"${previousInputs[\"legendary\"]}\" />\n        <span id=\"legendary-cut\"></span>\n      </div>\n      <div>\n        <b>Other Shares (Any Additional Shares):</b>\n        <input type=\"number\" name=\"other\" value=\"${previousInputs[\"other\"]}\" />\n        <span id=\"other-shares-cut\"></span>\n      </div>\n    `,\n    buttons: [\n      {\n        action: \"calculate\",\n        label: \"Calculate\",\n        callback: async (_event, target) => {\n          const netLoot = parseInt(target.form.elements.netLoot.value);\n          const travellers = parseInt(target.form.elements.travellers.value);\n          const captain = parseInt(target.form.elements.captain.value);\n          const isTravellerCaptain = target.form.elements.travellerCaptain.checked;\n          const ordinary = parseInt(target.form.elements.ordinary.value);\n          const good = parseInt(target.form.elements.good.value);\n          const excellent = parseInt(target.form.elements.excellent.value);\n          const legendary = parseInt(target.form.elements.legendary.value);\n          const other = parseInt(target.form.elements.other.value);\n\n          // Treat blank values as zero\n          const valuesToCheck = [netLoot, travellers, captain, ordinary, good, excellent, legendary, other];\n          for (let i = 0; i < valuesToCheck.length; i++) {\n            if (isNaN(valuesToCheck[i])) {\n              valuesToCheck[i] = 0;\n            }\n          }\n\n          // Calculate Ruler's Cut (10% of Net Loot)\n          const rulersCut = Math.floor(valuesToCheck[0] * 0.1);\n\n          // Calculate Gross Loot (Net Loot minus Ruler's Cut)\n          const grossLoot = valuesToCheck[0] - rulersCut;\n\n          // Calculate Total Shares\n          const totalShares = valuesToCheck[1] * 2 + valuesToCheck[2] * 5 + valuesToCheck[3] + valuesToCheck[4] * 2 + valuesToCheck[5] * 3 + valuesToCheck[6] * 5 + valuesToCheck[7];\n\n          // Calculate Traveller Cut\n          const travellerShares = valuesToCheck[1] * 2;\n          const travellerCut = Math.round((grossLoot / totalShares) * travellerShares);\n\n          // Calculate Captain Cut\n          const captainShares = valuesToCheck[2] * 5;\n          const captainCut = Math.round((grossLoot / totalShares) * captainShares);\n\n          // Calculate Ordinary Cut\n          const ordinaryCut = Math.round((grossLoot / totalShares) * valuesToCheck[3]);\n\n          // Calculate Good Cut\n          const goodShares = valuesToCheck[4] * 2;\n          const goodCut = Math.round((grossLoot / totalShares) * goodShares);\n\n          // Calculate Excellent Cut\n          const excellentShares = valuesToCheck[5] * 3;\n          const excellentCut = Math.round((grossLoot / totalShares) * excellentShares);\n\n          // Calculate Legendary Cut\n          const legendaryShares = valuesToCheck[6] * 5;\n          const legendaryCut = Math.round((grossLoot / totalShares) * legendaryShares);\n\n          // Calculate Other Shares Cut\n          const otherShares = valuesToCheck[7];\n          const otherSharesCut = Math.round((grossLoot / totalShares) * otherShares);\n\n          // Calculate Value per Share\n          const valuePerShare = Math.round(grossLoot / totalShares);\n\n          // Calculate Total Traveller Take\n          const totalTravellerTake = travellerCut + (isTravellerCaptain ? Math.floor(captainCut/captain) : 0);\n\n          // Save inputs and checkbox state to local storage\n          const inputs = {\n            \"netLoot\": valuesToCheck[0],\n            \"travellers\": valuesToCheck[1],\n            \"captain\": valuesToCheck[2],\n            \"ordinary\": valuesToCheck[3],\n            \"good\": valuesToCheck[4],\n            \"excellent\": valuesToCheck[5],\n            \"legendary\": valuesToCheck[6],\n            \"other\": valuesToCheck[7],\n            \"travellerCaptain\": isTravellerCaptain,\n          };\n          saveInputsToLocalStorage(inputs);\n\n          // Create a new dialog to display the results\n          const secondDialog = new foundry.applications.api.DialogV2({\n            window: {\n              title: \"Shares Calculation Result\",\n              icon: \"fa-solid fa-sack-xmark\"\n            },\n            content: `\n              <div>\n                <b>Ruler's Tithe</b> ${rulersCut}\n                <br>\n                <b>Gross Loot:</b> ${grossLoot}\n                <hr>\n                <b>Shares Breakdown:</b>\n                <table>\n                  <tr>\n                    <th>Shares Type</th>\n                    <th>Shares</th>\n                    <th>Cut</th>\n                  </tr>\n                  <tr>\n                    <td>Traveller Shares</td>\n                    <td>${travellerShares}</td>\n                    <td>${isNaN(travellerCut)? \"N/A\" : travellerCut}</td>\n                  </tr>\n                  <tr>\n                    <td>Captain Shares</td>\n                    <td>${captainShares}</td>\n                    <td>${isNaN(captainCut) ? \"N/A\" : captainCut}</td>\n                  </tr>\n                  <tr>\n                    <td>Ordinary Shares</td>\n                    <td>${valuesToCheck[3]}</td>\n                    <td>${isNaN(ordinaryCut) ? \"N/A\" : ordinaryCut}</td>\n                  </tr>\n                  <tr>\n                    <td>Good Shares</td>\n                    <td>${goodShares}</td>\n                    <td>${isNaN(goodCut) ? \"N/A\" : goodCut}</td>\n                  </tr>\n                  <tr>\n                    <td>Excellent Shares</td>\n                    <td>${excellentShares}</td>\n                    <td>${isNaN(excellentCut) ? \"N/A\" : excellentCut}</td>\n                  </tr>\n                  <tr>\n                    <td>Legendary Shares</td>\n                    <td>${legendaryShares}</td>\n                    <td>${isNaN(legendaryCut) ? \"N/A\" : legendaryCut}</td>\n                  </tr>\n                  <tr>\n                    <td>Other Shares</td>\n                    <td>${otherShares}</td>\n                    <td>${isNaN(otherSharesCut) ? \"N/A\" : otherSharesCut}</td>\n                  </tr>\n                </table>\n                <hr>\n                <b>Total Shares:</b> ${totalShares}\n                <br>\n                <b>Value per Share:</b> ${valuePerShare}\n                <br>\n                <b>Total Traveller Take:</b> ${totalTravellerTake}\n              </div>\n            `,\n            buttons: [\n              {\n                action: \"sendToChat\",\n                label: \"Send to Chat\",\n                callback: async (event2) => {\n                  // Get the content of the second dialog\n                  const content = event2.currentTarget.querySelector(\".dialog-content\").innerHTML;\n\n                  // Send the content to Foundry VTT's chat as a regular message\n                  ChatMessage.create({ content });\n                },\n              }\n            ]\n          });\n\n          // Render the second dialog\n          secondDialog.render(true);\n        },\n      },\n    ],\n  });\n\n  // Render the first dialog\n  firstDialog.render(true);\n})();",
  "folder": null,
  "ownership": {
    "default": 0,
    "g35c71Hsyv7w1Lw4": 3
  },
  "flags": {
    "core": {}
  },
  "_stats": {
    "compendiumSource": null,
    "duplicateSource": null,
    "coreVersion": "13.350",
    "systemId": "twodsix",
    "systemVersion": "6.8.1",
    "createdTime": 1738176328739,
    "modifiedTime": 1760016422571,
    "lastModifiedBy": "g35c71Hsyv7w1Lw4",
    "exportSource": null
  },
  "_id": "hJ2nJRTz41VWBILy",
  "sort": 1300000,
  "_key": "!macros!hJ2nJRTz41VWBILy"
}
