{
  "name": "UPP Translator v13",
  "type": "script",
  "author": "g35c71Hsyv7w1Lw4",
  "img": "systems/twodsix/assets/icons/science-planetology.svg",
  "scope": "global",
  "command": "// Simple UWP translator based on information from Cepheus Light, Cepheus Engine\n// SRD and https://travellermap.com/doc/secondsurvey#uwp\n// Updated for FVTT v13\n\ntranslateCode('text', 'Enter UWP Code');\nlet value = '';\nasync function translateCode (type, text) {\n  await foundry.applications.api.DialogV2.wait ({\n    modal: true,\n    window: {\n      title: 'Input UWP Code',\n      icon: 'fa-solid fa-globe'\n    },\n    content: `<table style=\"width:100%\"><tr><th><label>${text}</label></th><td><input type=\"${\n      type}\" name=\"input\"/></td></tr></table>`,\n    buttons: [\n      {\n        action: 'Ok',\n        label: 'Ok',\n        callback: (_event, target) => {\n          value = target.form.elements.input.value;\n        },\n        default: true\n      }\n    ],\n    render: (_ev, app) => {\n      app.querySelector(\"[name='input']\").focus();\n    },\n    close: () => {\n      Promise.resolve();\n    }\n  });\n\n  if (value !== '') {\n    let parse = parseCode(value);\n\n    await new Promise((resolve) => {\n      new foundry.applications.api.DialogV2({\n        modal: true,\n        window: {\n          title: `UWP Translation for: ${value}`,\n          icon: 'fa-solid fa-globe'\n        },\n        content:\n          `<table style=\"width:100%;\"><tbody><tr><th>Characteristic</th><th>Description</th></tr>${parse}</tbody></table>`,\n        buttons: [\n          {\n            action: 'Ok',\n            label: 'Ok',\n            default: true,\n            callback: () => {\n              resolve();\n            }\n          }\n        ]\n      }).render(true);\n    });\n  }\n}\n\nfunction parseCode (profile) {\n  // Strip out dash if used in profile\n  profile = profile.replace('-', '');\n\n  let UWPtables = [\n    'Starport Type', 'World Size - CL', 'Atmosphere', 'Hydrographics',\n    'Population', 'Government', 'Law Level - CL', 'Tech Level - CL'\n  ];\n\n  // parse starport, this is non-numeric\n  let message = `<tr><td style=\"padding-right:5px\">${UWPtables[0]} (${profile[0]})</td><td>${getStarportDescr(profile[0])}</td></tr>`;\n\n  // process rest of UWP\n  for (let i = 1; i < Math.min(profile.length, UWPtables.length); i++) {\n    message += `<tr>${getUWPparameter(profile[i], UWPtables[i])}</tr>`;\n  }\n\n  // generate trade codes\n  message += getTradeCodes(profile);\n  return (message);\n}\n\n// Lookup a hex digit from a roll table\nfunction getUWPparameter (inValue, tableName) {\n  let item = hexToBase10(inValue);\n  const table = game.tables.contents.find(t => t.name === tableName);\n  if (item < table.results.size) {\n    let details = table.results._source[item].text;\n    return (`<td style=\"padding-right:5px\">${tableName} (${inValue})</td><td>${details}</td>`);\n  } else {\n    return (`<td style=\"padding-right:5px\">${tableName} (${inValue})</td><td>UNKNOWN TABLE ITEM</td>`);\n  }\n}\n\n// Convert hex value to base10\nfunction hexToBase10 (inValue) {\n  switch (inValue.toUpperCase()) {\n    case 'A':\n      return (10);\n    case 'B':\n      return (11);\n    case 'C':\n      return (12);\n    case 'D':\n      return (13);\n    case 'E':\n      return (14);\n    case 'F':\n      return (15);\n    case 'G':\n      return (16);\n    default:\n      return (Number(inValue));\n  }\n}\n\n// Lookup starport description (letter values that are not hex)\nfunction getStarportDescr (inValue) {\n  let rtext = '';\n  switch (inValue.toUpperCase()) {\n    case 'A':\n      rtext =\n        'Excellent Quality. Refined fuel and annual maintenance overhaul available. Shipyard capable of constructing starships and non-starships present.';\n      break;\n    case 'B':\n      rtext =\n        'Good Quality. Refined fuel and annual maintenance overhaul available. Shipyard capable of constructing non-starships present.';\n      break;\n    case 'C':\n      rtext =\n        'Routine Quality. Only unrefined fuel available. Reasonable repair facilities present.';\n      break;\n    case 'D':\n      rtext =\n        'Poor Quality. Only unrefined fuel available. No repair facilities present.';\n      break;\n    case 'E':\n      rtext =\n        'Frontier Installation. Essentially a marked spot of bedrock with no fuel, facilities, or bases present.';\n      break;\n    case 'X':\n      rtext = 'No Starport. No provision is made for any ship landings.';\n      break;\n    default:\n      rtext = 'Unknown';\n  }\n  return (rtext);\n}\n\n// Generate Trade Codes per Cepheus Light Rules\nfunction getTradeCodes (profile) {\n  let rtext = '';\n\n  if (profile.length < 8) {\n    rtext += 'UWP Code too short</td></tr>';\n  } else {\n    const size = hexToBase10(profile[1]);\n    const atmo = hexToBase10(profile[2]);\n    const hydro = hexToBase10(profile[3]);\n    const pop = hexToBase10(profile[4]);\n    const techL = hexToBase10(profile[7]);\n\n    if (atmo > 3 && atmo < 10 && hydro > 3 && hydro < 9 && pop > 4 && pop < 8) {\n      rtext += 'Ag - Agricultural, ';\n    }\n\n    if (size === 0 && atmo === 0 && hydro === 0) {\n      rtext += 'Asteroid, ';\n    }\n\n    if (pop === 0) {\n      rtext += 'Ba - Barren, ';\n    }\n\n    if (atmo > 1 && hydro === 0) {\n      rtext += 'De - Desert, ';\n    }\n\n    if (atmo > 9 && hydro > 0) {\n      rtext += 'Fl - Non-water Fluid Oceans, ';\n    }\n\n    if ((atmo === 5 || atmo === 6 || atmo === 8) && hydro > 3 && hydro < 10 && pop > 3 && pop < 9) {\n      rtext += 'Ga - Garden, ';\n    }\n\n    if (pop > 8) {\n      rtext += 'Hi - High Population, ';\n    }\n\n    if (techL > 11) {\n      rtext += 'Ht - High Technology, ';\n    }\n\n    if (atmo < 2 && hydro > 0) {\n      rtext += 'Ic - Ice Capped, ';\n    }\n\n    if ((atmo < 3 || atmo === 4 || atmo === 7 || atmo === 9) && pop > 8) {\n      rtext += 'In - Industrial, ';\n    }\n\n    if (pop > 0 && pop < 4) {\n      rtext += 'Lo - Low Population, ';\n    }\n\n    if (techL < 6) {\n      rtext += 'Lt - Low Technology, ';\n    }\n\n    if (atmo < 4 && hydro < 4 && pop > 5) {\n      rtext += 'Na - Non Agricultural, ';\n    }\n\n    if (pop > 3 && pop < 7) {\n      rtext += 'Ni - Non Industrial, ';\n    }\n\n    if (atmo > 1 && atmo < 6 && hydro < 4) {\n      rtext += 'Po - Poor, ';\n    }\n\n    if ((atmo === 6 || atmo === 8) && pop > 5 && pop < 9) {\n      rtext += 'Ri - Rich, ';\n    }\n\n    if (hydro === 10) {\n      rtext += 'Wa - Water World, ';\n    }\n\n    if (atmo === 0) {\n      rtext += 'Va - Vacuum, ';\n    }\n    // Get rid of extra comma and space\n    if (rtext.length > 0) {\n      rtext = rtext.slice(0, -2);\n    }\n\n    rtext += '</td></tr>';\n  }\n\n  return (`<tr><td \"padding-right:5px\">Trade Codes</td><td>${rtext}`);\n}",
  "flags": {
    "core": {},
    "cf": {
      "id": "temp_f505ax12at"
    }
  },
  "ownership": {
    "default": 0,
    "g35c71Hsyv7w1Lw4": 3
  },
  "_stats": {
    "compendiumSource": "Macro.EZSLYFLu3zJdwEQ7",
    "duplicateSource": null,
    "coreVersion": "13.350",
    "systemId": "twodsix",
    "systemVersion": "6.8.1",
    "createdTime": 1738176337740,
    "modifiedTime": 1760016422573,
    "lastModifiedBy": "g35c71Hsyv7w1Lw4",
    "exportSource": null
  },
  "folder": null,
  "_id": "tb8C6TR4pPGdgLtR",
  "sort": 600000,
  "_key": "!macros!tb8C6TR4pPGdgLtR"
}
